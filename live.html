<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Quick Photos Album - powered by Cloudinary</title>



    <style>
        body {
            box-sizing: border-box;
            background: #eeeef1; 
        }

        h1{
            font-family: Georgia, serif;
            font-weight: 700;
            font-size:  3.15rem;
        }

        h2{
            font-family: sans-serif;
            font-weight: 300;
            font-size: 1.77rem ;
        }

        .albumcontents {
            background: #eeeef1;
        }

        img {
            border-radius: 5%;
            margin: 1px;
        }
    </style>
</head>

<body>
    <div class="albumheader">
        <h1 id="albumtitle">Album Title Placeholder</h1>
        <h2 id="albumdescription">If you can see this.... no data has been loaded</h2>
    </div>

    <div id="albumcontents">
    </div>


    <script>

        const urlParams = new URLSearchParams(window.location.search);
        const album_name = urlParams.get('album');
        // *** Change cloud_name to be the name of your Cloudinary account
        const cloud_name = 'quickalbum'; 
        

        window.addEventListener('DOMContentLoaded', (event) => {
            if ((album_name) && (cloud_name)) {
                loadPageDetails();
                loadImages();
            };

        });


        function loadPageDetails() {
            const title_object = document.getElementById('albumtitle');
            const description_object = document.getElementById('albumdescription');

            title_object.innerHTML = "The '" + album_name + "' Album";
            description_object.innerHTML = "Loaded from the '" + cloud_name + "' Account";    
        }



        function loadImages() {
            // form the full Cloudinary /list request 
            // note: /list needs to be approved on the account
            var album_contents_url = "https://res.cloudinary.com/" + cloud_name + "/image/list/" + album_name + ".json";
            const contents_object = document.getElementById('albumcontents');

            fetch(album_contents_url)
                .then((resp) => resp.json())
                .then(function (data) {

                    // create the DOM node that will contain the gallery
                    imageDiv = document.createElement("div");
                    imageDiv.id = "album";
                    contents_object.appendChild(imageDiv);

                    let imagelist = data.resources;
                    return imagelist.map(function (imageitem) {

                        // create an image element for each item from the /list results 
                        img = document.createElement("img");
                        img.class = "imageitem";
                        // initially, just a basic 300 x 300 image 
                        img.src = "https://res.cloudinary.com/" + cloud_name + "/image/upload/q_auto,f_auto/w_300,h_300,c_fill/e_improve/" + imageitem.public_id + "." + imageitem.format;

                        // append to the album container
                        imageDiv.appendChild(img);
                    })
                    
                    
                })
                .catch(function () {
                    // todo : catch errors
                });

        };

    </script>


</body>
</html>